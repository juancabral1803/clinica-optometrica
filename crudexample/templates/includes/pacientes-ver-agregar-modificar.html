<!doctype html>
<html>
<head>
        <script> 
            var accion=localStorage.getItem("accion");
            
            function ValidarAccion(){
                if(accion==="editar"){
                    Actualizar();
                }else{
                    AgregarNuevo()
                }
            }
            function cargar(){
                var accion=localStorage.getItem("accion");
                if(accion==="editar"){
                    var datosRecibidos = JSON.parse(localStorage.getItem("valoresFilaSeccionada"));
                    var accion=localStorage.getItem("accion");
                    $("#id").val(datosRecibidos.id);
                    $("#apellido_nombre").val(datosRecibidos.nombre);
                    $("#dni").val(datosRecibidos.dni);
                    $("#domicilio").val(datosRecibidos.domicilio);
                    $("#email").val(datosRecibidos.email);     
                    $("#telefono").val(datosRecibidos.telefono); 
                    document.getElementById('accion').innerHTML = accion;     
                }
               
            }
    
            function AgregarNuevo(){
            const csrf_token = getCookie('csrftoken');
            var data = {};
            data.nombre_apellido = document.getElementById("apellido_nombre").value;
            data.dni = document.getElementById("dni").value;
            data.domicilio = document.getElementById("domicilio").value;
            data.email = document.getElementById("email").value;
            data.telefono = document.getElementById("telefono").value;
            //var datosRecibidos = JSON.parse(localStorage.getItem("valoresFilaSeccionada"));
            $.ajax({
            type: "POST",
            url: "/pacientes/",
            data: data,
            beforeSend: function (xhr, settings) {
            xhr.setRequestHeader("X-CSRFToken", '{{ csrf_token }}');
            },
            success: function (arg) {
                alert("se agrego de forma correcta")
                location.href ="/vista_pacientes";
            }
            
            });
            }
     
    
            function Actualizar(){
            const csrf_token = getCookie('csrftoken');
            var data = {};
            data.nombre_apellido = document.getElementById("apellido_nombre").value;
            data.dni = document.getElementById("dni").value;
            data.domicilio = document.getElementById("domicilio").value;
            data.email = document.getElementById("email").value;
            data.telefono = document.getElementById("telefono").value;
            var datosRecibidos = JSON.parse(localStorage.getItem("valoresFilaSeccionada"));
            var Id=document.getElementById("id").value;
            var url="/pacientes/"+Id+"/";
            $.ajax({
            type: "patch",
            url: url,
            data: data,
            beforeSend: function (xhr, settings) {
            xhr.setRequestHeader("X-CSRFToken", '{{ csrf_token }}');
            },
            success: function (arg) {
                alert("se actualizo de forma correcta")
                location.href ="/vista_pacientes";
            }
            
            });
            }
    
            function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
            }
            return cookieValue;
            }

            function volver(){
            
                location.href = "/vista_pacientes"
            }
            
        </script>
        
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" crossorigin="anonymous"></script>

        <meta charset="utf-8">
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
		
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">

<meta charset="utf-8">
	
<title>pacientes-ver-agregar-modificar</title>
</head>


	
	<body onload="cargar()">
	<div style="background-color:#7B9CF6"><h1 aling="center" class="pacientes">PACIENTES</h1></div>
	<div><span id="accion"> </span></div>	
    <div class="container" aling="center">
    <div class="row">
        <div class="col-md-12">
            <div class="well well-sm">
                <div class="form-center">
                    <fieldset>
                        <legend class="text-center header">Agregar Pacientes</legend>
                        <div class="form-group">
                        <div class="col-md-8">
                            <input id="id" name="id" type="text" placeholder="id" class="form-control" style="visibility:hidden">
                        </div>
                        </div>
                        <div class="form-group">
                            <span class="col-md-1 col-md-offset-2 text-center"><i class="fa fa-user bigicon"></i></span>
 
                            <div class="col-md-8">
                                <input id="apellido_nombre" name="apellido_nombre" type="text" placeholder="Apellido y Nombre" class="form-control">
                            </div>
                        </div>
                        <div class="form-group">
                            <span class="col-md-1 col-md-offset-2 text-center"><i class="fa fa-user bigicon"></i></span>
                            <div class="col-md-8">
                                <input id="dni" name="dni" type="number" placeholder="NÂ°de Documento" class="form-control">
                            </div>
                        </div>
						    <div class="form-group">
                            <span class="col-md-1 col-md-offset-2 text-center"><i class="fa fa-user bigicon"></i></span>
                            <div class="col-md-8">
                                <input id="domicilio" name="domicilio" type="text" placeholder="Domicilio" class="form-control">
                            </div>
                        </div>

                        <div class="form-group">
                            <span class="col-md-1 col-md-offset-2 text-center"><i class="fa fa-envelope-o bigicon"></i></span>
                            <div class="col-md-8">
                                <input id="email" name="email" type="text" placeholder="Correo electronico" class="form-control">
                            </div>
                        </div>
						<div class="form-group">
                            <span class="col-md-1 col-md-offset-2 text-center"><i class="fa fa-phone-square bigicon"></i></span>
                            <div class="col-md-8">
                                <input id="telefono" name="telefono" type="number" placeholder="Telefono" class="form-control">
                            </div>
                        </div>

                        

	
						<div class="btn-group col-md-8 text-center">
                        <button type="button" id="guardar" class="btn btn-primary btn-lg" onclick="ValidarAccion()">Guardar</button>
                        <button type="button" class="btn btn-primary btn-lg" onclick="volver()">Volver</button>
  
</div>
                    </fieldset>
                </div>
            </div>
        </div>
    </div>
</div>
		
</body>
</html>
